<!-- Back Button -->
<div class="mb-4">
  <%= link_to "← Back to Dashboard", root_path,
    class: "inline-block bg-gray-200 text-gray-800 hover:bg-gray-300 px-4 py-2 rounded text-sm" %>
</div>

<!-- Page Title -->
<h1 class="text-2xl font-bold text-blue-700 mb-6">Sales Report</h1>

<!-- Filter Form -->
<%= form_with url: sales_path, method: :get, local: true, class: "flex flex-wrap items-end mb-6" do %>
  <div class="mr-[10px]">
    <label class="block text-sm font-medium text-gray-700">Product</label>
    <%= select_tag :product_id,
      options_from_collection_for_select(@products, :id, :name, params[:product_id]),
      include_blank: "All",
      class: "mt-1 block w-full px-3 py-2 border rounded" %>
  </div>

  <div class="mr-[10px]">
    <label class="block text-sm font-medium text-gray-700">Start Date</label>
    <%= date_field_tag :start_date, params[:start_date],
      class: "mt-1 block w-full px-3 py-2 border rounded" %>
  </div>

  <div class="mr-[10px]">
    <label class="block text-sm font-medium text-gray-700">End Date</label>
    <%= date_field_tag :end_date, params[:end_date],
      class: "mt-1 block w-full px-3 py-2 border rounded" %>
  </div>

  <div class="mr-[10px]">
    <%= submit_tag "Filter",
      class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 mt-6" %>
  </div>
<% end %>

<!-- CSV Download Button -->
<%= link_to "⬇ Download CSV",
  sales_path(request.query_parameters.merge(format: :csv)),
  class: "inline-block bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mb-6" %>

<!-- Sales Table -->
<% if @sales.any? %>
  <table class="min-w-full bg-white border border-gray-200 rounded shadow-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 border-b">Date</th>
        <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 border-b">Product</th>
        <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 border-b">Quantity</th>
      </tr>
    </thead>
    <tbody>
      <% @sales.each do |sale| %>
        <tr class="border-t hover:bg-gray-50">
          <td class="px-4 py-2 text-sm text-gray-800"><%= sale.created_at.strftime("%Y-%m-%d %H:%M") %></td>
          <td class="px-4 py-2 text-sm text-gray-800"><%= sale.product.name %></td>
          <td class="px-4 py-2 text-sm text-gray-800"><%= sale.quantity %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-gray-500 mt-4">No sales records found for the selected filters.</p>
<% end %>
